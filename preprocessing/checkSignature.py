from os import walk
import hashlib

path = 'dataset/benign_programs_WinXP_SP3/'

def listFiles(path):
    f = []
    for (dirpath, dirnames, filenames) in walk(path):
        f.extend(filenames)
        break
    return f


def getSignatures():
    file = open('preprocessing/md5digest.txt', 'r')
    signatues = []
    for line in file:
        sig = line.strip().split(' = ')
        signatues.append(sig[1])
    return signatues


if __name__ == "__main__":
    benign_programs = listFiles(path)
    #print(benign_programs)
    signatures = getSignatures()

    badSignature = []
    for i in range(0, len(benign_programs)):
        #calculate md5 hash of file
        result = hashlib.md5(open(path + str(benign_programs[i]),'rb').read()).hexdigest()
        if result in signatures:
            print('âœ” ' + result)
        else:
            badSignature.append(result)
    
    
    if len(badSignature) == 0:
        print('All good.')
    else:
        print('Bad signatures: ' + str(badSignature))
    
    